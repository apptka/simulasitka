<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi TKA - Mode Guru & Murid</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            background-image: linear-gradient(to bottom right, #e6f0ff, #f9fbff);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 100, 200, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a6dcc, #0d4d9c);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }
        
        .user-info {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 10px;
            margin-top: 15px;
            display: inline-block;
            font-size: 16px;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(5px);
        }
        
        .logo {
            font-size: 32px;
        }
        
        .app-container {
            display: flex;
            min-height: 700px;
        }
        
        .sidebar {
            width: 280px;
            background-color: #f8fbff;
            padding: 25px 20px;
            border-right: 1px solid #e1ecff;
            position: relative;
            z-index: 1;
        }
        
        .mode-selector {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border: 1px solid #e1ecff;
        }
        
        .mode-selector h4 {
            color: #1a6dcc;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .mode-buttons {
            display: flex;
            gap: 10px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #d1e3ff;
            background-color: white;
            color: #555;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .mode-btn:hover {
            background-color: #f0f7ff;
        }
        
        .mode-btn.active {
            background-color: #1a6dcc;
            color: white;
            border-color: #1a6dcc;
        }
        
        .menu-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .menu-item:hover {
            background-color: #e6f0ff;
        }
        
        .menu-item.active {
            background-color: #1a6dcc;
            color: white;
        }
        
        .menu-item i {
            font-size: 18px;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            position: relative;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        h2 {
            color: #1a6dcc;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e6f0ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .welcome-screen p {
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .class-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .class-card {
            background-color: #f8fbff;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(26, 109, 204, 0.15);
            border-color: #1a6dcc;
        }
        
        .class-card.selected {
            background-color: #e6f0ff;
            border-color: #1a6dcc;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(26, 109, 204, 0.15);
        }
        
        .class-card i {
            font-size: 50px;
            margin-bottom: 20px;
            color: #1a6dcc;
        }
        
        .class-card h3 {
            margin-bottom: 10px;
            color: #0d4d9c;
            font-size: 22px;
        }
        
        .class-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .subject-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .subject-card {
            background-color: #f8fbff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(26, 109, 204, 0.1);
            border-color: #1a6dcc;
        }
        
        .subject-card i {
            font-size: 40px;
            margin-bottom: 15px;
            color: #1a6dcc;
        }
        
        .subject-card h3 {
            margin-bottom: 10px;
            color: #0d4d9c;
        }
        
        .subject-info {
            font-size: 14px;
            color: #666;
        }
        
        .timer-box {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid #d1e3ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timer-section {
            flex: 1;
        }
        
        .timer {
            font-size: 28px;
            font-weight: bold;
            color: #1a6dcc;
            margin: 10px 0;
        }
        
        .question-counter {
            font-size: 16px;
            color: #666;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e1ecff;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #1a6dcc;
            width: 0%;
            transition: width 0.3s;
        }
        
        .question-box {
            background-color: #f8fbff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #1a6dcc;
        }
        
        .question-text {
            font-size: 18px;
            margin-bottom: 25px;
            font-weight: 500;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .option {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #e1ecff;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            background-color: #f0f7ff;
        }
        
        .option.selected {
            background-color: #e6f0ff;
            border-color: #1a6dcc;
        }
        
        .option.correct {
            background-color: #e8f5e9;
            border-color: #4CAF50;
        }
        
        .option.incorrect {
            background-color: #ffebee;
            border-color: #f44336;
        }
        
        .option-label {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e6f0ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a6dcc;
            flex-shrink: 0;
        }
        
        .option.selected .option-label {
            background-color: #1a6dcc;
            color: white;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background-color: #1a6dcc;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        button:hover {
            background-color: #0d4d9c;
            transform: translateY(-2px);
        }
        
        button.secondary {
            background-color: #f0f7ff;
            color: #1a6dcc;
        }
        
        button.secondary:hover {
            background-color: #e1ecff;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-summary {
            background-color: #f8fbff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .score-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(#4CAF50 0% 70%, #ff9800 70% 85%, #f44336 85% 100%);
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .score-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #1a6dcc;
        }
        
        .subject-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .subject-result {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .subject-result i {
            font-size: 30px;
            margin-bottom: 15px;
            color: #1a6dcc;
        }
        
        .result-details {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #e6f0ff;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .correct {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .incorrect {
            color: #f44336;
            font-weight: bold;
        }
        
        .skipped {
            color: #ff9800;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #e1ecff;
            margin-top: 30px;
        }
        
        .instructions {
            background-color: #f8fbff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #1a6dcc;
        }
        
        .instructions ul {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 400px;
        }
        
        .login-screen h2 {
            margin-bottom: 30px;
        }
        
        .login-input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #d1e3ff;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #1a6dcc;
        }
        
        .question-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .question-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 2px solid #e1ecff;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .question-number:hover {
            background-color: #f0f7ff;
        }
        
        .question-number.answered {
            background-color: #e6f0ff;
            border-color: #1a6dcc;
            color: #1a6dcc;
        }
        
        .question-number.current {
            background-color: #1a6dcc;
            color: white;
            border-color: #1a6dcc;
        }
        
        .question-number.skipped {
            background-color: #fff3e0;
            border-color: #ff9800;
            color: #ff9800;
        }
        
        .assistant-panel {
            background-color: #f0f7ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            border-left: 5px solid #ff9800;
            display: none;
        }
        
        .assistant-panel.show {
            display: block;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .assistant-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #0d4d9c;
        }
        
        .assistant-header i {
            font-size: 24px;
            color: #ff9800;
        }
        
        .assistant-content {
            line-height: 1.7;
        }
        
        .hint-btn {
            background-color: #ff9800;
            margin-top: 15px;
        }
        
        .hint-btn:hover {
            background-color: #e68900;
        }
        
        .class-progress {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e1ecff;
        }
        
        .progress-item {
            text-align: center;
            flex: 1;
        }
        
        .progress-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a6dcc;
        }
        
        .progress-label {
            font-size: 14px;
            color: #666;
        }
        
        /* Mode Guru */
        .teacher-dashboard {
            padding: 20px;
        }
        
        .teacher-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: #f8fbff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .stat-card i {
            font-size: 30px;
            color: #1a6dcc;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #1a6dcc;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .student-list {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .student-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            background-color: #1a6dcc;
            color: white;
            padding: 15px;
            font-weight: bold;
        }
        
        .student-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            padding: 15px;
            border-bottom: 1px solid #e6f0ff;
            align-items: center;
        }
        
        .student-row:hover {
            background-color: #f8fbff;
        }
        
        .student-row:last-child {
            border-bottom: none;
        }
        
        .student-name {
            font-weight: 500;
        }
        
        .student-score {
            text-align: center;
            font-weight: bold;
        }
        
        .student-score.high {
            color: #4CAF50;
        }
        
        .student-score.medium {
            color: #FF9800;
        }
        
        .student-score.low {
            color: #F44336;
        }
        
        .school-management {
            background-color: #f8fbff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #0d4d9c;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1e3ff;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1a6dcc;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .school-code {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px dashed #1a6dcc;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #1a6dcc;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert.success {
            background-color: #e8f5e9;
            border: 1px solid #4CAF50;
            color: #2e7d32;
        }
        
        .alert.error {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        
        .alert.warning {
            background-color: #fff3e0;
            border: 1px solid #ff9800;
            color: #ef6c00;
        }
        
        .alert.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 2px solid #d1e3ff;
            border-radius: 8px;
            background-color: white;
            font-size: 14px;
            min-width: 150px;
        }
        
        .export-btn {
            background-color: #4CAF50;
        }
        
        .export-btn:hover {
            background-color: #388e3c;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e1ecff;
            }
            
            .subject-list, .class-selection {
                grid-template-columns: 1fr;
            }
            
            .timer-box {
                flex-direction: column;
                gap: 15px;
            }
            
            .question-numbers {
                max-height: 150px;
            }
            
            .student-header, .student-row {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-graduation-cap logo"></i> Simulasi TKA - Mode Guru & Murid</h1>
            <p>Sistem pembelajaran dan penilaian terintegrasi untuk guru dan siswa</p>
            <div class="user-info" id="user-info" style="display: none;">
                <i class="fas fa-user"></i> 
                <span id="user-role-display">-</span> | 
                <span id="user-school-display">-</span>
                <span id="user-name-display" style="display: none;"> | Nama: <span id="user-name-value">-</span></span>
            </div>
        </header>
        
        <div class="app-container">
            <div class="sidebar" id="sidebar" style="display: none;">
                <div class="mode-selector" id="mode-selector">
                    <!-- Mode selector akan diisi oleh JavaScript -->
                </div>
                
                <div id="menu-items">
                    <!-- Menu items akan diisi oleh JavaScript -->
                </div>
            </div>
            
            <div class="main-content">
                <!-- Layar Pilih Mode -->
                <div class="screen active" id="mode-selection">
                    <div class="login-screen">
                        <h2><i class="fas fa-users"></i> Pilih Mode Pengguna</h2>
                        <p>Silakan pilih mode yang sesuai dengan peran Anda dalam sistem ini.</p>
                        
                        <div class="class-selection">
                            <div class="class-card" data-mode="student">
                                <i class="fas fa-user-graduate"></i>
                                <h3>Mode Murid</h3>
                                <p class="class-info">Untuk siswa yang ingin mengikuti simulasi TKA</p>
                                <div class="progress-label">Mengerjakan soal & melihat nilai</div>
                            </div>
                            
                            <div class="class-card" data-mode="teacher">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <h3>Mode Guru</h3>
                                <p class="class-info">Untuk guru yang ingin mengelola sekolah dan melihat nilai siswa</p>
                                <div class="progress-label">Kelola sekolah & pantau nilai</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Login Murid -->
                <div class="screen" id="student-login">
                    <div class="login-screen">
                        <h2><i class="fas fa-sign-in-alt"></i> Login Murid</h2>
                        <p>Masukkan data diri Anda untuk mengakses simulasi TKA</p>
                        
                        <div class="alert" id="student-alert"></div>
                        
                        <input type="text" class="login-input" id="student-school-input" placeholder="Masukkan Nama Sekolah" maxlength="100">
                        <input type="text" class="login-input" id="student-name-input" placeholder="Masukkan Nama Lengkap" maxlength="50">
                        <input type="password" class="login-input" id="student-code-input" placeholder="Masukkan Kode Sekolah (opsional)">
                        
                        <div class="action-buttons">
                            <button class="secondary" id="back-to-mode">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            <button id="student-login-btn">
                                <i class="fas fa-sign-in-alt"></i> Masuk
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Login/Daftar Guru -->
                <div class="screen" id="teacher-login">
                    <div class="login-screen">
                        <h2><i class="fas fa-sign-in-alt"></i> Login / Daftar Guru</h2>
                        <p>Masuk dengan akun guru yang sudah ada atau daftarkan sekolah baru</p>
                        
                        <div class="alert" id="teacher-alert"></div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" class="login-input" id="teacher-school-input" placeholder="Nama Sekolah" maxlength="100">
                            </div>
                            <div class="form-group">
                                <input type="password" class="login-input" id="teacher-password-input" placeholder="Password Guru" maxlength="50">
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="secondary" id="back-to-mode2">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            <button id="teacher-login-btn">
                                <i class="fas fa-sign-in-alt"></i> Login Guru
                            </button>
                            <button class="secondary" id="teacher-register-btn">
                                <i class="fas fa-plus-circle"></i> Daftar Sekolah Baru
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Guru -->
                <div class="screen" id="teacher-dashboard">
                    <div class="teacher-dashboard">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard Guru</h2>
                        
                        <div class="alert" id="teacher-dashboard-alert"></div>
                        
                        <div class="teacher-stats">
                            <div class="stat-card">
                                <i class="fas fa-school"></i>
                                <div class="stat-value" id="stat-school-name">-</div>
                                <div class="stat-label">Nama Sekolah</div>
                            </div>
                            
                            <div class="stat-card">
                                <i class="fas fa-user-graduate"></i>
                                <div class="stat-value" id="stat-total-students">0</div>
                                <div class="stat-label">Total Murid</div>
                            </div>
                            
                            <div class="stat-card">
                                <i class="fas fa-clipboard-check"></i>
                                <div class="stat-value" id="stat-total-tests">0</div>
                                <div class="stat-label">Total Tes Diselesaikan</div>
                            </div>
                            
                            <div class="stat-card">
                                <i class="fas fa-chart-line"></i>
                                <div class="stat-value" id="stat-average-score">0</div>
                                <div class="stat-label">Rata-rata Nilai</div>
                            </div>
                        </div>
                        
                        <div class="school-management">
                            <h3><i class="fas fa-cog"></i> Kelola Sekolah</h3>
                            
                            <div class="form-group">
                                <label>Kode Sekolah (berikan ke murid untuk bergabung)</label>
                                <div class="school-code" id="school-code-display">-</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nama Sekolah</label>
                                    <input type="text" class="form-control" id="edit-school-name" placeholder="Nama Sekolah">
                                </div>
                                <div class="form-group">
                                    <label>Password Guru</label>
                                    <input type="password" class="form-control" id="edit-teacher-password" placeholder="Password Baru">
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button id="update-school-btn">
                                    <i class="fas fa-save"></i> Perbarui Data Sekolah
                                </button>
                                <button class="secondary" id="export-data-btn">
                                    <i class="fas fa-download"></i> Ekspor Data Nilai
                                </button>
                            </div>
                        </div>
                        
                        <h3><i class="fas fa-list-alt"></i> Daftar Nilai Murid</h3>
                        
                        <div class="filter-options">
                            <select class="filter-select" id="filter-class">
                                <option value="all">Semua Kelas</option>
                                <option value="6sd">Kelas 6 SD</option>
                                <option value="2smp">Kelas 2 SMP</option>
                                <option value="3smp">Kelas 3 SMP</option>
                            </select>
                            
                            <select class="filter-select" id="filter-subject">
                                <option value="all">Semua Mata Pelajaran</option>
                                <option value="matematika">Matematika</option>
                                <option value="ipa">IPA</option>
                                <option value="bahasa-indonesia">Bahasa Indonesia</option>
                                <option value="english">Bahasa Inggris</option>
                            </select>
                            
                            <select class="filter-select" id="filter-sort">
                                <option value="name">Urutkan Nama</option>
                                <option value="score-desc">Nilai Tertinggi</option>
                                <option value="score-asc">Nilai Terendah</option>
                                <option value="date-desc">Terbaru</option>
                            </select>
                        </div>
                        
                        <div class="student-list">
                            <div class="student-header">
                                <div>Nama Murid</div>
                                <div>Kelas</div>
                                <div>Mata Pelajaran</div>
                                <div>Nilai</div>
                                <div>Tanggal</div>
                            </div>
                            <div id="student-results-list">
                                <!-- Daftar nilai murid akan diisi oleh JavaScript -->
                                <div class="student-row" style="text-align: center; padding: 40px;">
                                    <div style="grid-column: 1 / span 5;">Belum ada data nilai murid</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="navigation">
                            <button class="secondary" id="teacher-logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Keluar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Pilih Kelas Murid -->
                <div class="screen" id="class-selection">
                    <h2><i class="fas fa-graduation-cap"></i> Pilih Tingkat Kelas</h2>
                    <p>Hai, <span id="class-selection-name"></span>! Silakan pilih tingkat kelas yang sesuai dengan Anda.</p>
                    
                    <div class="class-selection">
                        <div class="class-card" data-class="6sd">
                            <i class="fas fa-child"></i>
                            <h3>Kelas 6 SD</h3>
                            <p class="class-info">Materi dasar Matematika, IPA, Bahasa Indonesia</p>
                            <div class="progress-label">15 soal per pelajaran</div>
                        </div>
                        
                        <div class="class-card" data-class="2smp">
                            <i class="fas fa-user-graduate"></i>
                            <h3>Kelas 2 SMP</h3>
                            <p class="class-info">Materi menengah dengan tambahan Bahasa Inggris</p>
                            <div class="progress-label">15 soal per pelajaran</div>
                        </div>
                        
                        <div class="class-card" data-class="3smp">
                            <i class="fas fa-user-graduate"></i>
                            <h3>Kelas 3 SMP</h3>
                            <p class="class-info">Materi lanjutan untuk persiapan ujian</p>
                            <div class="progress-label">15 soal per pelajaran</div>
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="back-to-student-login">
                            <i class="fas fa-arrow-left"></i> Kembali
                        </button>
                        <button id="confirm-class">
                            <i class="fas fa-check"></i> Konfirmasi Pilihan
                        </button>
                    </div>
                </div>
                
                <!-- Layar Beranda Murid -->
                <div class="screen" id="welcome">
                    <h2><i class="fas fa-door-open"></i> Selamat Datang, <span id="welcome-name"></span></h2>
                    <p>Hai, <span id="welcome-name2"></span>! Anda berada di <strong id="welcome-class"></strong> di <strong id="welcome-school"></strong>. 
                    Aplikasi ini akan membantu kamu mempersiapkan diri menghadapi Tes Kompetensi Akademik (TKA).</p>
                    
                    <div class="instructions">
                        <h3><i class="fas fa-info-circle"></i> Petunjuk Penggunaan:</h3>
                        <ul>
                            <li>Pilih mata pelajaran yang ingin kamu pelajari</li>
                            <li>Setiap tes terdiri dari <strong>15 soal</strong> pilihan ganda</li>
                            <li>Mode <strong>Simulasi</strong>: Tes dengan timer seperti ujian sesungguhnya</li>
                            <li>Mode <strong>Belajar</strong>: Dapatkan bantuan asisten dan pembahasan soal</li>
                            <li>Jawaban bisa diubah selama tes masih berlangsung</li>
                            <li>Hasil akan ditampilkan setelah tes selesai dan tersimpan di sistem sekolah</li>
                        </ul>
                    </div>
                    
                    <div class="class-progress">
                        <div class="progress-item">
                            <div class="progress-value" id="total-progress">0%</div>
                            <div class="progress-label">Total Progress</div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-value" id="average-score">0</div>
                            <div class="progress-label">Rata-rata Nilai</div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-value" id="completed-tests">0</div>
                            <div class="progress-label">Tes Selesai</div>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-history"></i> Riwayat Nilai Terakhir</h3>
                    <div class="subject-results" id="history-results">
                        <!-- Riwayat nilai akan diisi oleh JavaScript -->
                        <div class="subject-result">
                            <i class="fas fa-info-circle"></i>
                            <h4>Belum ada riwayat</h4>
                            <p>Kerjakan tes pertama Anda untuk melihat nilai</p>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;"><i class="fas fa-book-open"></i> Pilih Mata Pelajaran</h3>
                    <p>Silakan pilih mata pelajaran yang ingin kamu kerjakan:</p>
                    
                    <div class="subject-list" id="subject-list">
                        <!-- Daftar mata pelajaran akan diisi oleh JavaScript -->
                    </div>
                    
                    <div class="navigation" style="margin-top: 30px;">
                        <button class="secondary" id="student-logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Keluar
                        </button>
                    </div>
                </div>
                
                <!-- Layar Matematika -->
                <div class="screen" id="matematika">
                    <h2><i class="fas fa-calculator"></i> Tes Matematika</h2>
                    
                    <div class="timer-box">
                        <div class="timer-section">
                            <div>Waktu Tersisa:</div>
                            <div class="timer" id="matematika-timer">30:00</div>
                            <div class="question-counter">Soal <span id="matematika-current">1</span> dari 15</div>
                            <div class="progress-bar">
                                <div class="progress" id="matematika-progress"></div>
                            </div>
                        </div>
                        <div class="question-numbers" id="matematika-numbers">
                            <!-- Nomor soal akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-text" id="matematika-question"></div>
                        
                        <div class="options" id="matematika-options">
                            <!-- Opsi akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="assistant-panel" id="matematika-assistant">
                        <div class="assistant-header">
                            <i class="fas fa-robot"></i>
                            <h4>Asisten Matematika</h4>
                        </div>
                        <div class="assistant-content" id="matematika-assistant-content">
                            <!-- Konten asisten akan diisi oleh JavaScript -->
                        </div>
                        <button class="hint-btn" id="matematika-hint">
                            <i class="fas fa-lightbulb"></i> Berikan Petunjuk
                        </button>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="matematika-prev">
                            <i class="fas fa-arrow-left"></i> Sebelumnya
                        </button>
                        <div>
                            <button class="secondary" id="matematika-skip">
                                Lewati <i class="fas fa-forward"></i>
                            </button>
                            <button id="matematika-next">
                                Berikutnya <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar IPA -->
                <div class="screen" id="ipa">
                    <h2><i class="fas fa-flask"></i> Tes IPA</h2>
                    
                    <div class="timer-box">
                        <div class="timer-section">
                            <div>Waktu Tersisa:</div>
                            <div class="timer" id="ipa-timer">30:00</div>
                            <div class="question-counter">Soal <span id="ipa-current">1</span> dari 15</div>
                            <div class="progress-bar">
                                <div class="progress" id="ipa-progress"></div>
                            </div>
                        </div>
                        <div class="question-numbers" id="ipa-numbers">
                            <!-- Nomor soal akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-text" id="ipa-question"></div>
                        
                        <div class="options" id="ipa-options">
                            <!-- Opsi akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="assistant-panel" id="ipa-assistant">
                        <div class="assistant-header">
                            <i class="fas fa-robot"></i>
                            <h4>Asisten IPA</h4>
                        </div>
                        <div class="assistant-content" id="ipa-assistant-content">
                            <!-- Konten asisten akan diisi oleh JavaScript -->
                        </div>
                        <button class="hint-btn" id="ipa-hint">
                            <i class="fas fa-lightbulb"></i> Berikan Petunjuk
                        </button>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="ipa-prev">
                            <i class="fas fa-arrow-left"></i> Sebelumnya
                        </button>
                        <div>
                            <button class="secondary" id="ipa-skip">
                                Lewati <i class="fas fa-forward"></i>
                            </button>
                            <button id="ipa-next">
                                Berikutnya <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Bahasa Indonesia -->
                <div class="screen" id="bahasa-indonesia">
                    <h2><i class="fas fa-book"></i> Tes Bahasa Indonesia</h2>
                    
                    <div class="timer-box">
                        <div class="timer-section">
                            <div>Waktu Tersisa:</div>
                            <div class="timer" id="bahasa-indonesia-timer">30:00</div>
                            <div class="question-counter">Soal <span id="bahasa-indonesia-current">1</span> dari 15</div>
                            <div class="progress-bar">
                                <div class="progress" id="bahasa-indonesia-progress"></div>
                            </div>
                        </div>
                        <div class="question-numbers" id="bahasa-indonesia-numbers">
                            <!-- Nomor soal akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-text" id="bahasa-indonesia-question"></div>
                        
                        <div class="options" id="bahasa-indonesia-options">
                            <!-- Opsi akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="assistant-panel" id="bahasa-indonesia-assistant">
                        <div class="assistant-header">
                            <i class="fas fa-robot"></i>
                            <h4>Asisten Bahasa Indonesia</h4>
                        </div>
                        <div class="assistant-content" id="bahasa-indonesia-assistant-content">
                            <!-- Konten asisten akan diisi oleh JavaScript -->
                        </div>
                        <button class="hint-btn" id="bahasa-indonesia-hint">
                            <i class="fas fa-lightbulb"></i> Berikan Petunjuk
                        </button>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="bahasa-indonesia-prev">
                            <i class="fas fa-arrow-left"></i> Sebelumnya
                        </button>
                        <div>
                            <button class="secondary" id="bahasa-indonesia-skip">
                                Lewati <i class="fas fa-forward"></i>
                            </button>
                            <button id="bahasa-indonesia-next">
                                Berikutnya <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Bahasa Inggris -->
                <div class="screen" id="english">
                    <h2><i class="fas fa-language"></i> Tes Bahasa Inggris</h2>
                    
                    <div class="timer-box">
                        <div class="timer-section">
                            <div>Waktu Tersisa:</div>
                            <div class="timer" id="english-timer">30:00</div>
                            <div class="question-counter">Soal <span id="english-current">1</span> dari 15</div>
                            <div class="progress-bar">
                                <div class="progress" id="english-progress"></div>
                            </div>
                        </div>
                        <div class="question-numbers" id="english-numbers">
                            <!-- Nomor soal akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-text" id="english-question"></div>
                        
                        <div class="options" id="english-options">
                            <!-- Opsi akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="assistant-panel" id="english-assistant">
                        <div class="assistant-header">
                            <i class="fas fa-robot"></i>
                            <h4>English Assistant</h4>
                        </div>
                        <div class="assistant-content" id="english-assistant-content">
                            <!-- Konten asisten akan diisi oleh JavaScript -->
                        </div>
                        <button class="hint-btn" id="english-hint">
                            <i class="fas fa-lightbulb"></i> Give a Hint
                        </button>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="english-prev">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div>
                            <button class="secondary" id="english-skip">
                                Skip <i class="fas fa-forward"></i>
                            </button>
                            <button id="english-next">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Layar Hasil Tes -->
                <div class="screen" id="results">
                    <h2><i class="fas fa-chart-bar"></i> Hasil Simulasi TKA</h2>
                    
                    <div class="result-summary">
                        <p><strong>Nama:</strong> <span id="result-name"></span></p>
                        <p><strong>Sekolah:</strong> <span id="result-school"></span></p>
                        <p><strong>Kelas:</strong> <span id="result-class"></span></p>
                        <p><strong>Mata Pelajaran:</strong> <span id="result-subject"></span></p>
                        <p><strong>Tanggal:</strong> <span id="result-date"></span></p>
                        <p><strong>Mode:</strong> <span id="result-mode"></span></p>
                        
                        <div class="score-display">
                            <div class="score-circle">
                                <div class="score-inner">
                                    <span id="total-score">0</span>
                                </div>
                            </div>
                            <h3>Skor Total: <span id="score-text">0</span>/100</h3>
                            <p id="score-message"></p>
                        </div>
                        
                        <div class="subject-results" id="result-subject-results">
                            <!-- Hasil per mata pelajaran akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    
                    <div class="result-details">
                        <h3>Detail Jawaban:</h3>
                        <div id="results-details">
                            <!-- Detail hasil akan ditampilkan di sini -->
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="secondary" id="restart-test">
                            <i class="fas fa-redo"></i> Tes Ulang
                        </button>
                        <button id="back-to-welcome">
                            <i class="fas fa-home"></i> Kembali ke Beranda
                        </button>
                        <button id="save-result">
                            <i class="fas fa-save"></i> Simpan Nilai
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p> 2023 Simulasi TKA dengan Sistem Manajemen Sekolah  Aplikasi untuk guru dan siswa</p>
            <p>Disusun berdasarkan materi pelajaran sesuai kurikulum nasional</p>
        </footer>
    </div>

    <script>
        // ==================== DATA DAN KONSTANTA ====================
        
        // Data soal untuk setiap kelas dan mata pelajaran (sama seperti sebelumnya)
        // Karena keterbatasan ruang, saya akan gunakan data soal yang lebih singkat
        // Dalam implementasi nyata, gunakan data soal lengkap dari kode sebelumnya
        
        const questionsData = {
            "6sd": {
                matematika: Array(15).fill().map((_, i) => ({
                    question: `Soal Matematika 6 SD ${i+1}: Hasil dari ${i+10} + ${i+5} adalah...`,
                    options: [`${i+15}`, `${i+16}`, `${i+17}`, `${i+18}`],
                    answer: 0,
                    explanation: `Penjelasan: ${i+10} + ${i+5} = ${i+15}`
                })),
                ipa: Array(15).fill().map((_, i) => ({
                    question: `Soal IPA 6 SD ${i+1}: Planet terdekat dari matahari adalah...`,
                    options: ["Venus", "Mars", "Merkurius", "Bumi"],
                    answer: 2,
                    explanation: "Merkurius adalah planet terdekat dari matahari"
                })),
                "bahasa-indonesia": Array(15).fill().map((_, i) => ({
                    question: `Soal Bahasa Indonesia 6 SD ${i+1}: Sinonim dari kata 'pintar' adalah...`,
                    options: ["Bodoh", "Cerdas", "Malas", "Rajin"],
                    answer: 1,
                    explanation: "Sinonim pintar adalah cerdas"
                }))
            },
            "2smp": {
                matematika: Array(15).fill().map((_, i) => ({
                    question: `Soal Matematika 2 SMP ${i+1}: Hasil dari (${i+2}x + ${i+3})(x - ${i+1}) adalah...`,
                    options: [`${i+2}x - ${i+1}x - ${i+3}`, `${i+2}x + ${i+1}x - ${i+3}`, `${i+2}x - ${i+1}x + ${i+3}`, `${i+2}x + ${i+1}x + ${i+3}`],
                    answer: 0,
                    explanation: `Penjelasan aljabar untuk soal ${i+1}`
                })),
                ipa: Array(15).fill().map((_, i) => ({
                    question: `Soal IPA 2 SMP ${i+1}: Hukum kekekalan energi menyatakan bahwa energi...`,
                    options: ["Dapat diciptakan", "Dapat dimusnahkan", "Tidak dapat diciptakan atau dimusnahkan", "Hanya dapat berubah bentuk"],
                    answer: 2,
                    explanation: "Energi tidak dapat diciptakan atau dimusnahkan, hanya berubah bentuk"
                })),
                "bahasa-indonesia": Array(15).fill().map((_, i) => ({
                    question: `Soal Bahasa Indonesia 2 SMP ${i+1}: Kalimat yang menggunakan kata 'apabila' dengan tepat adalah...`,
                    options: [
                        "Apabila kamu belajar, maka kamu akan pandai",
                        "Kamu apabila belajar, maka kamu akan pandai",
                        "Kamu belajar apabila, maka kamu akan pandai",
                        "Kamu belajar, maka kamu akan pandai apabila"
                    ],
                    answer: 0,
                    explanation: "'Apabila' adalah konjungsi yang digunakan di awal anak kalimat"
                })),
                "english": Array(15).fill().map((_, i) => ({
                    question: `English Question 2 SMP ${i+1}: She ____ to school every day.`,
                    options: ["go", "goes", "going", "went"],
                    answer: 1,
                    explanation: "Simple Present Tense dengan she/he/it: verb + s/es"
                }))
            },
            "3smp": {
                matematika: Array(15).fill().map((_, i) => ({
                    question: `Soal Matematika 3 SMP ${i+1}: Nilai x dari persamaan ${i+2}x - ${i+5}x - ${i+3} = 0 adalah...`,
                    options: [`-${i+1}/2 dan ${i+3}`, `${i+1}/2 dan -${i+3}`, `-${i+1}/2 dan -${i+3}`, `${i+1}/2 dan ${i+3}`],
                    answer: 0,
                    explanation: `Penjelasan persamaan kuadrat untuk soal ${i+1}`
                })),
                ipa: Array(15).fill().map((_, i) => ({
                    question: `Soal IPA 3 SMP ${i+1}: Hukum Faraday tentang induksi elektromagnetik menyatakan bahwa...`,
                    options: [
                        "GGL induksi sebanding dengan laju perubahan fluks magnet",
                        "Arus listrik menghasilkan medan magnet",
                        "Muatan listrik tidak dapat diciptakan atau dimusnahkan",
                        "Energi listrik berbanding lurus dengan kuadrat arus"
                    ],
                    answer: 0,
                    explanation: "Hukum Faraday: GGL induksi sebanding dengan laju perubahan fluks magnetik"
                })),
                "bahasa-indonesia": Array(15).fill().map((_, i) => ({
                    question: `Soal Bahasa Indonesia 3 SMP ${i+1}: Karya sastra yang termasuk genre puisi baru adalah...`,
                    options: ["Pantun", "Syair", "Soneta", "Gurindam"],
                    answer: 2,
                    explanation: "Soneta adalah bentuk puisi baru (14 baris dengan pola rima tertentu)"
                })),
                "english": Array(15).fill().map((_, i) => ({
                    question: `English Question 3 SMP ${i+1}: If I ____ you, I would study harder.`,
                    options: ["am", "was", "were", "be"],
                    answer: 2,
                    explanation: "Conditional type 2: If + past tense (were untuk semua subjek)"
                }))
            }
        };
        
        // ==================== SISTEM PENYIMPANAN DATA ====================
        
        // Fungsi untuk menghasilkan ID unik
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // Fungsi untuk menghasilkan kode sekolah (6 karakter)
        function generateSchoolCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        // Fungsi untuk mendapatkan data dari localStorage
        function getStorageData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }
        
        // Fungsi untuk menyimpan data ke localStorage
        function setStorageData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }
        
        // Inisialisasi data sekolah jika belum ada
        function initializeSchoolData() {
            if (!getStorageData('tka_schools')) {
                setStorageData('tka_schools', {});
            }
            
            if (!getStorageData('tka_students')) {
                setStorageData('tka_students', {});
            }
            
            if (!getStorageData('tka_results')) {
                setStorageData('tka_results', {});
            }
        }
        
        // Fungsi untuk mendaftarkan sekolah baru
        function registerSchool(schoolName, teacherPassword) {
            const schools = getStorageData('tka_schools');
            const schoolCode = generateSchoolCode();
            
            // Cek apakah sekolah sudah terdaftar
            for (const code in schools) {
                if (schools[code].name.toLowerCase() === schoolName.toLowerCase()) {
                    return { success: false, message: 'Sekolah sudah terdaftar' };
                }
            }
            
            // Daftarkan sekolah baru
            schools[schoolCode] = {
                id: schoolCode,
                name: schoolName,
                teacherPassword: teacherPassword,
                createdAt: new Date().toISOString(),
                students: []
            };
            
            setStorageData('tka_schools', schools);
            return { success: true, schoolCode: schoolCode };
        }
        
        // Fungsi untuk login guru
        function teacherLogin(schoolName, password) {
            const schools = getStorageData('tka_schools');
            
            for (const code in schools) {
                if (schools[code].name.toLowerCase() === schoolName.toLowerCase()) {
                    if (schools[code].teacherPassword === password) {
                        return { success: true, schoolCode: code, schoolData: schools[code] };
                    } else {
                        return { success: false, message: 'Password salah' };
                    }
                }
            }
            
            return { success: false, message: 'Sekolah tidak ditemukan' };
        }
        
        // Fungsi untuk login murid
        function studentLogin(schoolName, studentName, schoolCode = null) {
            const schools = getStorageData('tka_schools');
            const students = getStorageData('tka_students');
            
            // Cari sekolah berdasarkan nama atau kode
            let foundSchoolCode = null;
            let foundSchool = null;
            
            if (schoolCode) {
                // Cari dengan kode sekolah
                if (schools[schoolCode]) {
                    foundSchoolCode = schoolCode;
                    foundSchool = schools[schoolCode];
                }
            } else {
                // Cari dengan nama sekolah (harus persis)
                for (const code in schools) {
                    if (schools[code].name === schoolName) {
                        foundSchoolCode = code;
                        foundSchool = schools[code];
                        break;
                    }
                }
            }
            
            if (!foundSchool) {
                return { success: false, message: 'Sekolah tidak ditemukan. Pastikan nama sekolah benar atau gunakan kode sekolah.' };
            }
            
            // Cek apakah murid sudah terdaftar di sekolah ini
            const studentId = `${foundSchoolCode}_${studentName.toLowerCase().replace(/\s+/g, '_')}`;
            
            if (!students[studentId]) {
                // Daftarkan murid baru
                students[studentId] = {
                    id: studentId,
                    name: studentName,
                    schoolCode: foundSchoolCode,
                    schoolName: foundSchool.name,
                    class: null,
                    createdAt: new Date().toISOString(),
                    results: {}
                };
                
                // Tambahkan ke daftar murid sekolah
                if (!foundSchool.students.includes(studentId)) {
                    foundSchool.students.push(studentId);
                    schools[foundSchoolCode] = foundSchool;
                    setStorageData('tka_schools', schools);
                }
                
                setStorageData('tka_students', students);
            }
            
            return { 
                success: true, 
                studentId: studentId, 
                studentData: students[studentId],
                schoolCode: foundSchoolCode,
                schoolName: foundSchool.name
            };
        }
        
        // Fungsi untuk menyimpan hasil tes
        function saveTestResult(studentId, classLevel, subject, score, correct, total, answers, mode) {
            const students = getStorageData('tka_students');
            const results = getStorageData('tka_results');
            
            if (!students[studentId]) {
                return { success: false, message: 'Murid tidak ditemukan' };
            }
            
            // Update data murid
            if (!students[studentId].results[classLevel]) {
                students[studentId].results[classLevel] = {};
            }
            
            if (!students[studentId].results[classLevel][subject]) {
                students[studentId].results[classLevel][subject] = [];
            }
            
            const resultId = generateId();
            const testResult = {
                id: resultId,
                studentId: studentId,
                studentName: students[studentId].name,
                schoolCode: students[studentId].schoolCode,
                schoolName: students[studentId].schoolName,
                class: classLevel,
                subject: subject,
                score: score,
                correct: correct,
                total: total,
                answers: answers,
                mode: mode,
                date: new Date().toISOString()
            };
            
            // Simpan hasil tes
            students[studentId].results[classLevel][subject].push(testResult);
            
            // Simpan di koleksi hasil terpusat
            if (!results[students[studentId].schoolCode]) {
                results[students[studentId].schoolCode] = {};
            }
            
            results[students[studentId].schoolCode][resultId] = testResult;
            
            // Update kelas murid jika belum ada
            if (!students[studentId].class) {
                students[studentId].class = classLevel;
            }
            
            setStorageData('tka_students', students);
            setStorageData('tka_results', results);
            
            return { success: true, resultId: resultId };
        }
        
        // Fungsi untuk mendapatkan hasil tes murid
        function getStudentResults(studentId) {
            const students = getStorageData('tka_students');
            return students[studentId] ? students[studentId].results : {};
        }
        
        // Fungsi untuk mendapatkan semua hasil tes sekolah
        function getSchoolResults(schoolCode) {
            const results = getStorageData('tka_results');
            return results[schoolCode] || {};
        }
        
        // Fungsi untuk mendapatkan statistik sekolah
        function getSchoolStats(schoolCode) {
            const schools = getStorageData('tka_schools');
            const students = getStorageData('tka_students');
            const results = getStorageData('tka_results');
            
            if (!schools[schoolCode]) {
                return null;
            }
            
            const school = schools[schoolCode];
            const schoolResults = results[schoolCode] || {};
            
            let totalStudents = school.students.length;
            let totalTests = Object.keys(schoolResults).length;
            let totalScore = 0;
            let testCount = 0;
            
            // Hitung rata-rata nilai
            for (const resultId in schoolResults) {
                totalScore += schoolResults[resultId].score;
                testCount++;
            }
            
            const averageScore = testCount > 0 ? Math.round(totalScore / testCount) : 0;
            
            return {
                schoolName: school.name,
                totalStudents: totalStudents,
                totalTests: totalTests,
                averageScore: averageScore,
                createdAt: school.createdAt
            };
        }
        
        // ==================== STATE APLIKASI ====================
        
        let state = {
            // Informasi pengguna
            userRole: null, // 'teacher' atau 'student'
            userSchoolCode: null,
            userSchoolName: null,
            userName: null,
            userId: null,
            
            // Untuk murid
            selectedClass: null,
            currentScreen: 'mode-selection',
            currentSubject: null,
            currentQuestionIndex: 0,
            mode: 'simulation', // 'simulation' atau 'learning'
            
            // Data tes
            answers: {
                matematika: Array(15).fill(null),
                ipa: Array(15).fill(null),
                "bahasa-indonesia": Array(15).fill(null),
                "english": Array(15).fill(null)
            },
            
            // Timer
            timers: {
                matematika: 30 * 60,
                ipa: 30 * 60,
                "bahasa-indonesia": 30 * 60,
                "english": 30 * 60
            },
            timerIntervals: {},
            testStarted: {
                matematika: false,
                ipa: false,
                "bahasa-indonesia": false,
                "english": false
            },
            
            // Progress
            progress: {
                matematika: 0,
                ipa: 0,
                "bahasa-indonesia": 0,
                "english": 0
            },
            
            // Data hasil tes sementara
            currentTestResult: null
        };
        
        // ==================== FUNGSI UTILITAS ====================
        
        // Fungsi untuk menampilkan alert
        function showAlert(elementId, message, type = 'success') {
            const alertElement = document.getElementById(elementId);
            alertElement.textContent = message;
            alertElement.className = `alert ${type}`;
            alertElement.classList.add('show');
            
            // Sembunyikan alert setelah 5 detik
            setTimeout(() => {
                alertElement.classList.remove('show');
            }, 5000);
        }
        
        // Fungsi untuk mengubah layar
        function changeScreen(screenId) {
            // Hentikan timer dari layar sebelumnya jika ada
            if (state.currentSubject && state.timerIntervals[state.currentSubject]) {
                clearInterval(state.timerIntervals[state.currentSubject]);
            }
            
            // Sembunyikan semua layar
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Tampilkan layar yang dipilih
            document.getElementById(screenId).classList.add('active');
            
            // Update state
            state.currentScreen = screenId;
            
            // Update tampilan berdasarkan screen
            if (screenId === 'teacher-dashboard') {
                loadTeacherDashboard();
            } else if (screenId === 'welcome') {
                loadStudentWelcome();
            } else if (screenId === 'results') {
                loadResultsScreen();
            }
        }
        
        // ==================== FUNGSI MODE GURU ====================
        
        // Fungsi untuk memuat dashboard guru
        function loadTeacherDashboard() {
            // Tampilkan info sekolah
            const stats = getSchoolStats(state.userSchoolCode);
            
            if (stats) {
                document.getElementById('stat-school-name').textContent = stats.schoolName;
                document.getElementById('stat-total-students').textContent = stats.totalStudents;
                document.getElementById('stat-total-tests').textContent = stats.totalTests;
                document.getElementById('stat-average-score').textContent = stats.averageScore;
                
                // Tampilkan kode sekolah
                document.getElementById('school-code-display').textContent = state.userSchoolCode;
                
                // Isi form edit
                document.getElementById('edit-school-name').value = stats.schoolName;
                
                // Muat daftar nilai murid
                loadStudentResults();
            }
        }
        
        // Fungsi untuk memuat hasil murid
        function loadStudentResults() {
            const results = getSchoolResults(state.userSchoolCode);
            const resultsList = document.getElementById('student-results-list');
            
            // Dapatkan filter
            const filterClass = document.getElementById('filter-class').value;
            const filterSubject = document.getElementById('filter-subject').value;
            const filterSort = document.getElementById('filter-sort').value;
            
            // Konversi ke array untuk sorting
            let resultsArray = [];
            
            for (const resultId in results) {
                resultsArray.push(results[resultId]);
            }
            
            // Filter hasil
            if (filterClass !== 'all') {
                resultsArray = resultsArray.filter(result => result.class === filterClass);
            }
            
            if (filterSubject !== 'all') {
                resultsArray = resultsArray.filter(result => result.subject === filterSubject);
            }
            
            // Sort hasil
            if (filterSort === 'name') {
                resultsArray.sort((a, b) => a.studentName.localeCompare(b.studentName));
            } else if (filterSort === 'score-desc') {
                resultsArray.sort((a, b) => b.score - a.score);
            } else if (filterSort === 'score-asc') {
                resultsArray.sort((a, b) => a.score - b.score);
            } else if (filterSort === 'date-desc') {
                resultsArray.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            // Kosongkan daftar
            resultsList.innerHTML = '';
            
            // Tampilkan hasil
            if (resultsArray.length === 0) {
                const emptyRow = document.createElement('div');
                emptyRow.className = 'student-row';
                emptyRow.style.textAlign = 'center';
                emptyRow.style.padding = '40px';
                emptyRow.innerHTML = '<div style="grid-column: 1 / span 5;">Belum ada data nilai murid</div>';
                resultsList.appendChild(emptyRow);
                return;
            }
            
            resultsArray.forEach(result => {
                const row = document.createElement('div');
                row.className = 'student-row';
                
                // Format tanggal
                const date = new Date(result.date);
                const formattedDate = date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                // Format kelas
                let classDisplay = '';
                switch(result.class) {
                    case '6sd': classDisplay = 'Kelas 6 SD'; break;
                    case '2smp': classDisplay = 'Kelas 2 SMP'; break;
                    case '3smp': classDisplay = 'Kelas 3 SMP'; break;
                    default: classDisplay = result.class;
                }
                
                // Format mata pelajaran
                let subjectDisplay = '';
                switch(result.subject) {
                    case 'matematika': subjectDisplay = 'Matematika'; break;
                    case 'ipa': subjectDisplay = 'IPA'; break;
                    case 'bahasa-indonesia': subjectDisplay = 'Bahasa Indonesia'; break;
                    case 'english': subjectDisplay = 'Bahasa Inggris'; break;
                    default: subjectDisplay = result.subject;
                }
                
                // Tentukan kelas CSS untuk nilai
                let scoreClass = 'student-score';
                if (result.score >= 80) {
                    scoreClass += ' high';
                } else if (result.score >= 60) {
                    scoreClass += ' medium';
                } else {
                    scoreClass += ' low';
                }
                
                row.innerHTML = `
                    <div class="student-name">${result.studentName}</div>
                    <div>${classDisplay}</div>
                    <div>${subjectDisplay}</div>
                    <div class="${scoreClass}">${result.score}</div>
                    <div>${formattedDate}</div>
                `;
                
                resultsList.appendChild(row);
            });
        }
        
        // Fungsi untuk update data sekolah
        function updateSchoolData() {
            const schoolName = document.getElementById('edit-school-name').value;
            const newPassword = document.getElementById('edit-teacher-password').value;
            
            if (!schoolName.trim()) {
                showAlert('teacher-dashboard-alert', 'Nama sekolah tidak boleh kosong', 'error');
                return;
            }
            
            const schools = getStorageData('tka_schools');
            
            if (!schools[state.userSchoolCode]) {
                showAlert('teacher-dashboard-alert', 'Sekolah tidak ditemukan', 'error');
                return;
            }
            
            // Update nama sekolah
            schools[state.userSchoolCode].name = schoolName;
            
            // Update password jika diisi
            if (newPassword.trim()) {
                schools[state.userSchoolCode].teacherPassword = newPassword;
            }
            
            setStorageData('tka_schools', schools);
            
            // Update state
            state.userSchoolName = schoolName;
            updateUserInfo();
            
            showAlert('teacher-dashboard-alert', 'Data sekolah berhasil diperbarui', 'success');
            
            // Reload dashboard
            loadTeacherDashboard();
        }
        
        // Fungsi untuk ekspor data
        function exportSchoolData() {
            const results = getSchoolResults(state.userSchoolCode);
            const students = getStorageData('tka_students');
            
            // Filter hanya siswa dari sekolah ini
            const schoolStudents = {};
            for (const studentId in students) {
                if (students[studentId].schoolCode === state.userSchoolCode) {
                    schoolStudents[studentId] = students[studentId];
                }
            }
            
            const exportData = {
                schoolCode: state.userSchoolCode,
                schoolName: state.userSchoolName,
                exportDate: new Date().toISOString(),
                students: schoolStudents,
                results: results
            };
            
            // Buat blob dan download
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data-nilai-${state.userSchoolCode}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('teacher-dashboard-alert', 'Data berhasil diekspor', 'success');
        }
        
        // ==================== FUNGSI MODE MURID ====================
        
        // Fungsi untuk memuat beranda murid
        function loadStudentWelcome() {
            // Tampilkan info murid
            document.getElementById('welcome-name').textContent = state.userName;
            document.getElementById('welcome-name2').textContent = state.userName;
            document.getElementById('welcome-school').textContent = state.userSchoolName;
            
            // Tampilkan kelas jika sudah dipilih
            if (state.selectedClass) {
                let classDisplay = '';
                switch(state.selectedClass) {
                    case '6sd': classDisplay = 'Kelas 6 SD'; break;
                    case '2smp': classDisplay = 'Kelas 2 SMP'; break;
                    case '3smp': classDisplay = 'Kelas 3 SMP'; break;
                    default: classDisplay = state.selectedClass;
                }
                document.getElementById('welcome-class').textContent = classDisplay;
            } else {
                document.getElementById('welcome-class').textContent = 'Belum memilih kelas';
            }
            
            // Muat progress dan riwayat
            updateStudentProgress();
            loadStudentHistory();
            
            // Update daftar mata pelajaran
            updateSubjectList();
        }
        
        // Fungsi untuk update progress murid
        function updateStudentProgress() {
            const results = getStudentResults(state.userId);
            
            if (!state.selectedClass || !results[state.selectedClass]) {
                document.getElementById('total-progress').textContent = '0%';
                document.getElementById('average-score').textContent = '0';
                document.getElementById('completed-tests').textContent = '0';
                return;
            }
            
            const classResults = results[state.selectedClass];
            let totalTests = 0;
            let totalScore = 0;
            
            // Hitung statistik
            for (const subject in classResults) {
                if (classResults[subject].length > 0) {
                    totalTests += classResults[subject].length;
                    const latestResult = classResults[subject][classResults[subject].length - 1];
                    totalScore += latestResult.score;
                }
            }
            
            const averageScore = totalTests > 0 ? Math.round(totalScore / totalTests) : 0;
            const progress = totalTests > 0 ? Math.min(100, Math.round((totalTests / 4) * 100)) : 0; // Maks 4 mata pelajaran
            
            document.getElementById('total-progress').textContent = `${progress}%`;
            document.getElementById('average-score').textContent = averageScore;
            document.getElementById('completed-tests').textContent = totalTests;
        }
        
        // Fungsi untuk memuat riwayat nilai
        function loadStudentHistory() {
            const results = getStudentResults(state.userId);
            const historyContainer = document.getElementById('history-results');
            
            if (!state.selectedClass || !results[state.selectedClass]) {
                historyContainer.innerHTML = `
                    <div class="subject-result">
                        <i class="fas fa-info-circle"></i>
                        <h4>Belum ada riwayat</h4>
                        <p>Kerjakan tes pertama Anda untuk melihat nilai</p>
                    </div>
                `;
                return;
            }
            
            const classResults = results[state.selectedClass];
            let historyHTML = '';
            let count = 0;
            
            // Ambil nilai terbaru untuk setiap mata pelajaran
            for (const subject in classResults) {
                if (classResults[subject].length > 0 && count < 4) {
                    const latestResult = classResults[subject][classResults[subject].length - 1];
                    
                    // Tentukan ikon berdasarkan mata pelajaran
                    let icon = 'fa-book';
                    if (subject === 'matematika') icon = 'fa-calculator';
                    else if (subject === 'ipa') icon = 'fa-flask';
                    else if (subject === 'english') icon = 'fa-language';
                    
                    // Tentukan kelas CSS untuk nilai
                    let scoreClass = '';
                    if (latestResult.score >= 80) scoreClass = 'correct';
                    else if (latestResult.score >= 60) scoreClass = 'skipped';
                    else scoreClass = 'incorrect';
                    
                    // Format mata pelajaran
                    let subjectDisplay = '';
                    switch(subject) {
                        case 'matematika': subjectDisplay = 'Matematika'; break;
                        case 'ipa': subjectDisplay = 'IPA'; break;
                        case 'bahasa-indonesia': subjectDisplay = 'Bahasa Indonesia'; break;
                        case 'english': subjectDisplay = 'Bahasa Inggris'; break;
                        default: subjectDisplay = subject;
                    }
                    
                    historyHTML += `
                        <div class="subject-result">
                            <i class="fas ${icon}"></i>
                            <h4>${subjectDisplay}</h4>
                            <p>Nilai: <span class="${scoreClass}">${latestResult.score}</span>/100</p>
                            <p>${latestResult.correct} benar dari ${latestResult.total} soal</p>
                        </div>
                    `;
                    
                    count++;
                }
            }
            
            if (historyHTML === '') {
                historyHTML = `
                    <div class="subject-result">
                        <i class="fas fa-info-circle"></i>
                        <h4>Belum ada riwayat</h4>
                        <p>Kerjakan tes pertama Anda untuk melihat nilai</p>
                    </div>
                `;
            }
            
            historyContainer.innerHTML = historyHTML;
        }
        
        // Fungsi untuk update daftar mata pelajaran
        function updateSubjectList() {
            const subjectList = document.getElementById('subject-list');
            subjectList.innerHTML = '';
            
            let subjects = [];
            
            // Tentukan mata pelajaran berdasarkan kelas
            switch(state.selectedClass) {
                case '6sd':
                    subjects = [
                        { id: 'matematika', name: 'Matematika', icon: 'fa-calculator', desc: '15 soal  30 menit' },
                        { id: 'ipa', name: 'IPA', icon: 'fa-flask', desc: '15 soal  30 menit' },
                        { id: 'bahasa-indonesia', name: 'Bahasa Indonesia', icon: 'fa-book', desc: '15 soal  30 menit' }
                    ];
                    break;
                    
                case '2smp':
                case '3smp':
                    subjects = [
                        { id: 'matematika', name: 'Matematika', icon: 'fa-calculator', desc: '15 soal  30 menit' },
                        { id: 'ipa', name: 'IPA', icon: 'fa-flask', desc: '15 soal  30 menit' },
                        { id: 'bahasa-indonesia', name: 'Bahasa Indonesia', icon: 'fa-book', desc: '15 soal  30 menit' },
                        { id: 'english', name: 'Bahasa Inggris', icon: 'fa-language', desc: '15 soal  30 menit' }
                    ];
                    break;
            }
            
            // Buat kartu mata pelajaran
            subjects.forEach(subject => {
                const subjectCard = document.createElement('div');
                subjectCard.className = 'subject-card';
                subjectCard.dataset.subject = subject.id;
                
                subjectCard.innerHTML = `
                    <i class="fas ${subject.icon}"></i>
                    <h3>${subject.name}</h3>
                    <p class="subject-info">${subject.desc}</p>
                    <div class="progress-label">Progress: ${state.progress[subject.id]}%</div>
                `;
                
                subjectCard.addEventListener('click', function() {
                    // Reset jawaban untuk mata pelajaran ini
                    state.answers[subject.id] = Array(15).fill(null);
                    state.currentSubject = subject.id;
                    state.currentQuestionIndex = 0;
                    
                    // Load soal pertama
                    loadQuestion(subject.id, 0);
                    createQuestionNumbers(subject.id);
                    
                    // Tampilkan atau sembunyikan panel asisten berdasarkan mode
                    const assistantPanel = document.getElementById(`${subject.id}-assistant`);
                    if (state.mode === 'learning') {
                        assistantPanel.classList.add('show');
                    } else {
                        assistantPanel.classList.remove('show');
                    }
                    
                    // Mulai timer jika mode simulasi
                    if (state.mode === 'simulation') {
                        startTimer(subject.id);
                        state.testStarted[subject.id] = true;
                    }
                    
                    changeScreen(subject.id);
                });
                
                subjectList.appendChild(subjectCard);
            });
        }
        
        // ==================== FUNGSI TES ====================
        
        // Fungsi untuk membuat nomor-nomor soal
        function createQuestionNumbers(subject) {
            const numbersContainer = document.getElementById(`${subject}-numbers`);
            numbersContainer.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                const numberElement = document.createElement('div');
                numberElement.className = 'question-number';
                numberElement.textContent = i + 1;
                numberElement.dataset.index = i;
                
                // Tandai status soal
                if (state.answers[subject][i] !== null) {
                    numberElement.classList.add('answered');
                }
                
                if (i === state.currentQuestionIndex) {
                    numberElement.classList.add('current');
                }
                
                numberElement.addEventListener('click', () => {
                    state.currentQuestionIndex = i;
                    loadQuestion(subject, i);
                    updateQuestionNumbers(subject);
                });
                
                numbersContainer.appendChild(numberElement);
            }
        }
        
        // Fungsi untuk memperbarui tampilan nomor soal
        function updateQuestionNumbers(subject) {
            const numbers = document.querySelectorAll(`#${subject}-numbers .question-number`);
            numbers.forEach((number, i) => {
                number.classList.remove('current');
                number.classList.remove('answered');
                
                if (i === state.currentQuestionIndex) {
                    number.classList.add('current');
                }
                
                if (state.answers[subject][i] !== null) {
                    number.classList.add('answered');
                }
            });
        }
        
        // Fungsi untuk memuat soal
        function loadQuestion(subject, index) {
            const questions = questionsData[state.selectedClass][subject];
            if (!questions || !questions[index]) {
                console.error(`Soal tidak ditemukan: kelas=${state.selectedClass}, subject=${subject}, index=${index}`);
                return;
            }
            
            const question = questions[index];
            
            // Update teks soal
            document.getElementById(`${subject}-question`).textContent = `${index + 1}. ${question.question}`;
            
            // Update counter soal
            document.getElementById(`${subject}-current`).textContent = index + 1;
            
            // Update progress bar
            const progress = ((index + 1) / 15) * 100;
            document.getElementById(`${subject}-progress`).style.width = `${progress}%`;
            
            // Bersihkan opsi sebelumnya
            const optionsContainer = document.getElementById(`${subject}-options`);
            optionsContainer.innerHTML = '';
            
            // Tambahkan opsi baru
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (state.answers[subject][index] === i) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-label">${String.fromCharCode(65 + i)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(subject, index, i));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update konten asisten jika mode belajar
            if (state.mode === 'learning' && question.explanation) {
                document.getElementById(`${subject}-assistant-content`).textContent = question.explanation;
            }
            
            // Update status tombol navigasi
            const prevButton = document.getElementById(`${subject}-prev`);
            prevButton.disabled = index === 0;
            
            const nextButton = document.getElementById(`${subject}-next`);
            if (index === questions.length - 1) {
                nextButton.innerHTML = `<i class="fas fa-flag-checkered"></i> Selesai`;
                nextButton.onclick = () => finishTest(subject);
            } else {
                nextButton.innerHTML = state.currentScreen === 'english' ? 
                    `Next <i class="fas fa-arrow-right"></i>` : 
                    `Berikutnya <i class="fas fa-arrow-right"></i>`;
                nextButton.onclick = () => nextQuestion(subject);
            }
        }
        
        // Fungsi untuk memilih opsi
        function selectOption(subject, questionIndex, optionIndex) {
            state.answers[subject][questionIndex] = optionIndex;
            
            // Update tampilan opsi yang dipilih
            const options = document.querySelectorAll(`#${subject}-options .option`);
            options.forEach((option, i) => {
                if (i === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
            
            // Update nomor soal
            updateQuestionNumbers(subject);
            
            // Jika mode belajar, berikan feedback langsung
            if (state.mode === 'learning') {
                const questions = questionsData[state.selectedClass][subject];
                const correctAnswer = questions[questionIndex].answer;
                
                // Tandai jawaban yang benar dan salah
                options.forEach((option, i) => {
                    if (i === correctAnswer) {
                        option.classList.add('correct');
                    } else if (i === optionIndex && i !== correctAnswer) {
                        option.classList.add('incorrect');
                    }
                });
            }
        }
        
        // Fungsi untuk memberikan petunjuk
        function giveHint(subject) {
            const questions = questionsData[state.selectedClass][subject];
            const currentQuestion = questions[state.currentQuestionIndex];
            
            if (currentQuestion && currentQuestion.explanation) {
                const assistantContent = document.getElementById(`${subject}-assistant-content`);
                assistantContent.textContent = `Petunjuk: ${currentQuestion.explanation}`;
            }
        }
        
        // Fungsi untuk pindah ke soal berikutnya
        function nextQuestion(subject) {
            if (state.currentQuestionIndex < 14) {
                state.currentQuestionIndex++;
                loadQuestion(subject, state.currentQuestionIndex);
                updateQuestionNumbers(subject);
            }
        }
        
        // Fungsi untuk pindah ke soal sebelumnya
        function prevQuestion(subject) {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                loadQuestion(subject, state.currentQuestionIndex);
                updateQuestionNumbers(subject);
            }
        }
        
        // Fungsi untuk melewatkan soal
        function skipQuestion(subject) {
            state.answers[subject][state.currentQuestionIndex] = null;
            
            // Update nomor soal
            updateQuestionNumbers(subject);
            
            if (state.currentQuestionIndex < 14) {
                state.currentQuestionIndex++;
                loadQuestion(subject, state.currentQuestionIndex);
                updateQuestionNumbers(subject);
            }
        }
        
        // Fungsi untuk memulai timer
        function startTimer(subject) {
            // Hentikan timer sebelumnya jika ada
            if (state.timerIntervals[subject]) {
                clearInterval(state.timerIntervals[subject]);
            }
            
            // Reset timer jika sudah 0
            if (state.timers[subject] <= 0) {
                state.timers[subject] = 30 * 60;
            }
            
            // Update tampilan timer
            updateTimerDisplay(subject);
            
            // Jalankan timer
            state.timerIntervals[subject] = setInterval(() => {
                state.timers[subject]--;
                updateTimerDisplay(subject);
                
                // Jika waktu habis, selesaikan tes
                if (state.timers[subject] <= 0) {
                    clearInterval(state.timerIntervals[subject]);
                    finishTest(subject);
                }
            }, 1000);
        }
        
        // Fungsi untuk memperbarui tampilan timer
        function updateTimerDisplay(subject) {
            const minutes = Math.floor(state.timers[subject] / 60);
            const seconds = state.timers[subject] % 60;
            const timerElement = document.getElementById(`${subject}-timer`);
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Ubah warna menjadi merah jika waktu kurang dari 5 menit
            if (state.timers[subject] < 300) {
                timerElement.style.color = '#f44336';
            } else {
                timerElement.style.color = '#1a6dcc';
            }
        }
        
        // Fungsi untuk menyelesaikan tes
        function finishTest(subject) {
            // Hentikan timer
            if (state.timerIntervals[subject]) {
                clearInterval(state.timerIntervals[subject]);
                delete state.timerIntervals[subject];
            }
            
            // Hitung hasil
            calculateTestResult(subject);
            
            // Tampilkan layar hasil
            changeScreen('results');
        }
        
        // Fungsi untuk menghitung hasil tes
        function calculateTestResult(subject) {
            const questions = questionsData[state.selectedClass][subject];
            let correctCount = 0;
            
            for (let i = 0; i < questions.length; i++) {
                if (state.answers[subject][i] === questions[i].answer) {
                    correctCount++;
                }
            }
            
            // Hitung skor (per 15 soal, nilai maksimal 100)
            const score = Math.round((correctCount / questions.length) * 100);
            
            // Simpan hasil sementara
            state.currentTestResult = {
                subject: subject,
                score: score,
                correct: correctCount,
                total: questions.length,
                answers: [...state.answers[subject]],
                class: state.selectedClass,
                mode: state.mode
            };
        }
        
        // Fungsi untuk memuat layar hasil
        function loadResultsScreen() {
            if (!state.currentTestResult) return;
            
            const result = state.currentTestResult;
            
            // Tampilkan informasi
            document.getElementById('result-name').textContent = state.userName;
            document.getElementById('result-school').textContent = state.userSchoolName;
            
            // Format kelas
            let classDisplay = '';
            switch(result.class) {
                case '6sd': classDisplay = 'Kelas 6 SD'; break;
                case '2smp': classDisplay = 'Kelas 2 SMP'; break;
                case '3smp': classDisplay = 'Kelas 3 SMP'; break;
                default: classDisplay = result.class;
            }
            document.getElementById('result-class').textContent = classDisplay;
            
            // Format mata pelajaran
            let subjectDisplay = '';
            switch(result.subject) {
                case 'matematika': subjectDisplay = 'Matematika'; break;
                case 'ipa': subjectDisplay = 'IPA'; break;
                case 'bahasa-indonesia': subjectDisplay = 'Bahasa Indonesia'; break;
                case 'english': subjectDisplay = 'Bahasa Inggris'; break;
                default: subjectDisplay = result.subject;
            }
            document.getElementById('result-subject').textContent = subjectDisplay;
            
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('result-date').textContent = now.toLocaleDateString('id-ID', options);
            
            const modeDisplay = state.mode === 'simulation' ? 'Mode Simulasi' : 'Mode Belajar';
            document.getElementById('result-mode').textContent = modeDisplay;
            
            // Tampilkan skor
            document.getElementById('total-score').textContent = result.score;
            document.getElementById('score-text').textContent = result.score;
            
            // Tampilkan pesan berdasarkan skor
            const scoreMessage = document.getElementById('score-message');
            if (result.score >= 85) {
                scoreMessage.textContent = "Sangat baik! Kamu sudah menguasai materi dengan baik.";
                scoreMessage.style.color = "#4CAF50";
            } else if (result.score >= 70) {
                scoreMessage.textContent = "Baik! Namun masih perlu sedikit belajar lagi.";
                scoreMessage.style.color = "#FF9800";
            } else if (result.score >= 60) {
                scoreMessage.textContent = "Cukup! Disarankan untuk belajar lebih giat lagi.";
                scoreMessage.style.color = "#FF9800";
            } else {
                scoreMessage.textContent = "Perlu peningkatan! Disarankan untuk belajar lebih serius.";
                scoreMessage.style.color = "#f44336";
            }
            
            // Tampilkan hasil per mata pelajaran
            const subjectResults = document.getElementById('result-subject-results');
            subjectResults.innerHTML = `
                <div class="subject-result">
                    <i class="fas ${result.subject === 'matematika' ? 'fa-calculator' : result.subject === 'ipa' ? 'fa-flask' : result.subject === 'english' ? 'fa-language' : 'fa-book'}"></i>
                    <h4>${subjectDisplay}</h4>
                    <p>Nilai: <span>${result.score}</span>/100</p>
                    <p>${result.correct} benar dari ${result.total} soal</p>
                </div>
            `;
            
            // Tampilkan detail jawaban
            const resultsDetails = document.getElementById('results-details');
            resultsDetails.innerHTML = '';
            
            const questions = questionsData[state.selectedClass][result.subject];
            
            for (let i = 0; i < questions.length; i++) {
                const detailItem = document.createElement('div');
                detailItem.className = 'detail-item';
                
                const isCorrect = result.answers[i] === questions[i].answer;
                const isSkipped = result.answers[i] === null;
                
                let statusText = '';
                let statusClass = '';
                
                if (isSkipped) {
                    statusText = 'Tidak dijawab';
                    statusClass = 'skipped';
                } else if (isCorrect) {
                    statusText = 'Benar';
                    statusClass = 'correct';
                } else {
                    statusText = 'Salah';
                    statusClass = 'incorrect';
                }
                
                detailItem.innerHTML = `
                    <div>Soal ${i + 1}: ${questions[i].question.substring(0, 60)}...</div>
                    <div class="${statusClass}">${statusText}</div>
                `;
                
                resultsDetails.appendChild(detailItem);
            }
        }
        
        // Fungsi untuk menyimpan hasil tes
        function saveTestResultToSystem() {
            if (!state.currentTestResult || !state.userId) {
                showAlert('results', 'Gagal menyimpan hasil tes', 'error');
                return;
            }
            
            const result = state.currentTestResult;
            const saveResult = saveTestResult(
                state.userId,
                result.class,
                result.subject,
                result.score,
                result.correct,
                result.total,
                result.answers,
                result.mode
            );
            
            if (saveResult.success) {
                showAlert('results', 'Hasil tes berhasil disimpan di sistem sekolah', 'success');
                
                // Update data murid di state
                const students = getStorageData('tka_students');
                if (students[state.userId]) {
                    // Update kelas murid jika belum ada
                    if (!students[state.userId].class) {
                        students[state.userId].class = result.class;
                        setStorageData('tka_students', students);
                        state.selectedClass = result.class;
                    }
                }
                
                // Nonaktifkan tombol simpan
                document.getElementById('save-result').disabled = true;
                document.getElementById('save-result').innerHTML = '<i class="fas fa-check"></i> Tersimpan';
            } else {
                showAlert('results', 'Gagal menyimpan hasil tes: ' + saveResult.message, 'error');
            }
        }
        
        // ==================== FUNGSI UI ====================
        
        // Fungsi untuk mengupdate informasi pengguna di header
        function updateUserInfo() {
            const userInfo = document.getElementById('user-info');
            const roleDisplay = document.getElementById('user-role-display');
            const schoolDisplay = document.getElementById('user-school-display');
            const nameDisplay = document.getElementById('user-name-display');
            const nameValue = document.getElementById('user-name-value');
            
            if (state.userRole) {
                userInfo.style.display = 'block';
                
                if (state.userRole === 'teacher') {
                    roleDisplay.textContent = 'Guru';
                    nameDisplay.style.display = 'none';
                } else {
                    roleDisplay.textContent = 'Murid';
                    nameDisplay.style.display = 'inline';
                    nameValue.textContent = state.userName;
                }
                
                schoolDisplay.textContent = state.userSchoolName;
            } else {
                userInfo.style.display = 'none';
            }
        }
        
        // Fungsi untuk mengupdate sidebar berdasarkan role
        function updateSidebar() {
            const sidebar = document.getElementById('sidebar');
            const modeSelector = document.getElementById('mode-selector');
            const menuItems = document.getElementById('menu-items');
            
            if (state.userRole) {
                sidebar.style.display = 'block';
                
                // Update mode selector
                if (state.userRole === 'student') {
                    modeSelector.innerHTML = `
                        <h4><i class="fas fa-cogs"></i> Mode Belajar</h4>
                        <div class="mode-buttons">
                            <div class="mode-btn ${state.mode === 'simulation' ? 'active' : ''}" data-mode="simulation">
                                <i class="fas fa-clock"></i> Simulasi
                            </div>
                            <div class="mode-btn ${state.mode === 'learning' ? 'active' : ''}" data-mode="learning">
                                <i class="fas fa-chalkboard-teacher"></i> Belajar
                            </div>
                        </div>
                    `;
                    
                    // Update menu items untuk murid
                    menuItems.innerHTML = `
                        <div class="menu-item ${state.currentScreen === 'welcome' ? 'active' : ''}" data-screen="welcome">
                            <i class="fas fa-home"></i> Beranda
                        </div>
                        <div class="menu-item ${state.currentScreen === 'matematika' ? 'active' : ''}" data-screen="matematika">
                            <i class="fas fa-calculator"></i> Matematika
                        </div>
                        <div class="menu-item ${state.currentScreen === 'ipa' ? 'active' : ''}" data-screen="ipa">
                            <i class="fas fa-flask"></i> IPA
                        </div>
                        <div class="menu-item ${state.currentScreen === 'bahasa-indonesia' ? 'active' : ''}" data-screen="bahasa-indonesia">
                            <i class="fas fa-book"></i> Bahasa Indonesia
                        </div>
                        ${state.selectedClass !== '6sd' ? `
                        <div class="menu-item ${state.currentScreen === 'english' ? 'active' : ''}" data-screen="english">
                            <i class="fas fa-language"></i> Bahasa Inggris
                        </div>
                        ` : ''}
                        <div class="menu-item ${state.currentScreen === 'results' ? 'active' : ''}" data-screen="results">
                            <i class="fas fa-chart-bar"></i> Hasil & Nilai
                        </div>
                    `;
                } else {
                    // Mode selector tidak diperlukan untuk guru
                    modeSelector.innerHTML = `
                        <h4><i class="fas fa-user-tie"></i> Mode Guru</h4>
                        <p style="font-size: 14px; color: #666; margin: 5px 0 0 0;">Sekolah: ${state.userSchoolName}</p>
                    `;
                    
                    // Menu items untuk guru
                    menuItems.innerHTML = `
                        <div class="menu-item ${state.currentScreen === 'teacher-dashboard' ? 'active' : ''}" data-screen="teacher-dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </div>
                    `;
                }
                
                // Tambahkan event listeners untuk menu items
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const screenId = this.dataset.screen;
                        changeScreen(screenId);
                    });
                });
                
                // Tambahkan event listeners untuk mode buttons (murid saja)
                if (state.userRole === 'student') {
                    document.querySelectorAll('.mode-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const mode = this.dataset.mode;
                            state.mode = mode;
                            
                            // Update UI
                            document.querySelectorAll('.mode-btn').forEach(b => {
                                b.classList.remove('active');
                            });
                            this.classList.add('active');
                            
                            // Jika sedang di layar tes, update tampilan asisten
                            if (['matematika', 'ipa', 'bahasa-indonesia', 'english'].includes(state.currentScreen)) {
                                const assistantPanel = document.getElementById(`${state.currentScreen}-assistant`);
                                if (mode === 'learning') {
                                    assistantPanel.classList.add('show');
                                } else {
                                    assistantPanel.classList.remove('show');
                                }
                            }
                        });
                    });
                }
            } else {
                sidebar.style.display = 'none';
            }
        }
        
        // ==================== INISIALISASI ====================
        
        // Inisialisasi data sekolah
        initializeSchoolData();
        
        // ==================== EVENT LISTENERS ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Pilih mode (guru/murid)
            document.querySelectorAll('.class-card[data-mode]').forEach(card => {
                card.addEventListener('click', function() {
                    const mode = this.dataset.mode;
                    
                    if (mode === 'student') {
                        changeScreen('student-login');
                    } else if (mode === 'teacher') {
                        changeScreen('teacher-login');
                    }
                });
            });
            
            // Kembali ke pilih mode
            document.getElementById('back-to-mode').addEventListener('click', () => changeScreen('mode-selection'));
            document.getElementById('back-to-mode2').addEventListener('click', () => changeScreen('mode-selection'));
            
            // Login murid
            document.getElementById('student-login-btn').addEventListener('click', function() {
                const schoolName = document.getElementById('student-school-input').value.trim();
                const studentName = document.getElementById('student-name-input').value.trim();
                const schoolCode = document.getElementById('student-code-input').value.trim();
                
                if (!schoolName && !schoolCode) {
                    showAlert('student-alert', 'Masukkan nama sekolah atau kode sekolah', 'error');
                    return;
                }
                
                if (!studentName) {
                    showAlert('student-alert', 'Masukkan nama lengkap', 'error');
                    return;
                }
                
                const loginResult = studentLogin(schoolName, studentName, schoolCode || null);
                
                if (loginResult.success) {
                    // Set state murid
                    state.userRole = 'student';
                    state.userId = loginResult.studentId;
                    state.userName = studentName;
                    state.userSchoolCode = loginResult.schoolCode;
                    state.userSchoolName = loginResult.schoolName;
                    
                    // Update UI
                    updateUserInfo();
                    updateSidebar();
                    
                    // Tampilkan layar pilih kelas
                    document.getElementById('class-selection-name').textContent = studentName;
                    changeScreen('class-selection');
                } else {
                    showAlert('student-alert', loginResult.message, 'error');
                }
            });
            
            // Pilih kelas murid
            document.querySelectorAll('.class-card[data-class]').forEach(card => {
                card.addEventListener('click', function() {
                    // Hapus seleksi sebelumnya
                    document.querySelectorAll('.class-card[data-class]').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Tandai kelas yang dipilih
                    this.classList.add('selected');
                    
                    // Simpan kelas yang dipilih
                    state.selectedClass = this.dataset.class;
                });
            });
            
            // Konfirmasi pilihan kelas
            document.getElementById('confirm-class').addEventListener('click', function() {
                if (!state.selectedClass) {
                    alert('Silakan pilih kelas terlebih dahulu!');
                    return;
                }
                
                // Simpan kelas murid di data
                const students = getStorageData('tka_students');
                if (students[state.userId]) {
                    students[state.userId].class = state.selectedClass;
                    setStorageData('tka_students', students);
                }
                
                // Tampilkan beranda murid
                changeScreen('welcome');
            });
            
            // Kembali ke login murid
            document.getElementById('back-to-student-login').addEventListener('click', () => changeScreen('student-login'));
            
            // Login guru
            document.getElementById('teacher-login-btn').addEventListener('click', function() {
                const schoolName = document.getElementById('teacher-school-input').value.trim();
                const password = document.getElementById('teacher-password-input').value.trim();
                
                if (!schoolName) {
                    showAlert('teacher-alert', 'Masukkan nama sekolah', 'error');
                    return;
                }
                
                if (!password) {
                    showAlert('teacher-alert', 'Masukkan password guru', 'error');
                    return;
                }
                
                const loginResult = teacherLogin(schoolName, password);
                
                if (loginResult.success) {
                    // Set state guru
                    state.userRole = 'teacher';
                    state.userSchoolCode = loginResult.schoolCode;
                    state.userSchoolName = loginResult.schoolData.name;
                    
                    // Update UI
                    updateUserInfo();
                    updateSidebar();
                    
                    // Tampilkan dashboard guru
                    changeScreen('teacher-dashboard');
                } else {
                    showAlert('teacher-alert', loginResult.message, 'error');
                }
            });
            
            // Daftar sekolah baru
            document.getElementById('teacher-register-btn').addEventListener('click', function() {
                const schoolName = document.getElementById('teacher-school-input').value.trim();
                const password = document.getElementById('teacher-password-input').value.trim();
                
                if (!schoolName) {
                    showAlert('teacher-alert', 'Masukkan nama sekolah', 'error');
                    return;
                }
                
                if (!password) {
                    showAlert('teacher-alert', 'Masukkan password guru', 'error');
                    return;
                }
                
                const registerResult = registerSchool(schoolName, password);
                
                if (registerResult.success) {
                    // Set state guru
                    state.userRole = 'teacher';
                    state.userSchoolCode = registerResult.schoolCode;
                    state.userSchoolName = schoolName;
                    
                    // Update UI
                    updateUserInfo();
                    updateSidebar();
                    
                    // Tampilkan dashboard guru
                    showAlert('teacher-alert', `Sekolah berhasil didaftarkan! Kode sekolah: ${registerResult.schoolCode}`, 'success');
                    changeScreen('teacher-dashboard');
                } else {
                    showAlert('teacher-alert', registerResult.message, 'error');
                }
            });
            
            // Update data sekolah
            document.getElementById('update-school-btn').addEventListener('click', updateSchoolData);
            
            // Ekspor data sekolah
            document.getElementById('export-data-btn').addEventListener('click', exportSchoolData);
            
            // Filter hasil murid
            document.getElementById('filter-class').addEventListener('change', loadStudentResults);
            document.getElementById('filter-subject').addEventListener('change', loadStudentResults);
            document.getElementById('filter-sort').addEventListener('change', loadStudentResults);
            
            // Logout guru
            document.getElementById('teacher-logout-btn').addEventListener('click', function() {
                state = {
                    userRole: null,
                    userSchoolCode: null,
                    userSchoolName: null,
                    userName: null,
                    userId: null,
                    selectedClass: null,
                    currentScreen: 'mode-selection',
                    currentSubject: null,
                    currentQuestionIndex: 0,
                    mode: 'simulation',
                    answers: {
                        matematika: Array(15).fill(null),
                        ipa: Array(15).fill(null),
                        "bahasa-indonesia": Array(15).fill(null),
                        "english": Array(15).fill(null)
                    },
                    timers: {
                        matematika: 30 * 60,
                        ipa: 30 * 60,
                        "bahasa-indonesia": 30 * 60,
                        "english": 30 * 60
                    },
                    timerIntervals: {},
                    testStarted: {
                        matematika: false,
                        ipa: false,
                        "bahasa-indonesia": false,
                        "english": false
                    },
                    progress: {
                        matematika: 0,
                        ipa: 0,
                        "bahasa-indonesia": 0,
                        "english": 0
                    },
                    currentTestResult: null
                };
                
                changeScreen('mode-selection');
            });
            
            // Logout murid
            document.getElementById('student-logout-btn').addEventListener('click', function() {
                state = {
                    userRole: null,
                    userSchoolCode: null,
                    userSchoolName: null,
                    userName: null,
                    userId: null,
                    selectedClass: null,
                    currentScreen: 'mode-selection',
                    currentSubject: null,
                    currentQuestionIndex: 0,
                    mode: 'simulation',
                    answers: {
                        matematika: Array(15).fill(null),
                        ipa: Array(15).fill(null),
                        "bahasa-indonesia": Array(15).fill(null),
                        "english": Array(15).fill(null)
                    },
                    timers: {
                        matematika: 30 * 60,
                        ipa: 30 * 60,
                        "bahasa-indonesia": 30 * 60,
                        "english": 30 * 60
                    },
                    timerIntervals: {},
                    testStarted: {
                        matematika: false,
                        ipa: false,
                        "bahasa-indonesia": false,
                        "english": false
                    },
                    progress: {
                        matematika: 0,
                        ipa: 0,
                        "bahasa-indonesia": 0,
                        "english": 0
                    },
                    currentTestResult: null
                };
                
                changeScreen('mode-selection');
            });
            
            // Tombol navigasi tes
            // Matematika
            document.getElementById('matematika-prev').addEventListener('click', () => prevQuestion('matematika'));
            document.getElementById('matematika-skip').addEventListener('click', () => skipQuestion('matematika'));
            document.getElementById('matematika-hint').addEventListener('click', () => giveHint('matematika'));
            
            // IPA
            document.getElementById('ipa-prev').addEventListener('click', () => prevQuestion('ipa'));
            document.getElementById('ipa-skip').addEventListener('click', () => skipQuestion('ipa'));
            document.getElementById('ipa-hint').addEventListener('click', () => giveHint('ipa'));
            
            // Bahasa Indonesia
            document.getElementById('bahasa-indonesia-prev').addEventListener('click', () => prevQuestion('bahasa-indonesia'));
            document.getElementById('bahasa-indonesia-skip').addEventListener('click', () => skipQuestion('bahasa-indonesia'));
            document.getElementById('bahasa-indonesia-hint').addEventListener('click', () => giveHint('bahasa-indonesia'));
            
            // Bahasa Inggris
            document.getElementById('english-prev').addEventListener('click', () => prevQuestion('english'));
            document.getElementById('english-skip').addEventListener('click', () => skipQuestion('english'));
            document.getElementById('english-hint').addEventListener('click', () => giveHint('english'));
            
            // Tombol di layar hasil
            document.getElementById('restart-test').addEventListener('click', function() {
                if (state.currentTestResult && state.currentTestResult.subject) {
                    // Reset jawaban untuk mata pelajaran yang sama
                    state.answers[state.currentTestResult.subject] = Array(15).fill(null);
                    state.currentSubject = state.currentTestResult.subject;
                    state.currentQuestionIndex = 0;
                    
                    // Load soal pertama
                    loadQuestion(state.currentTestResult.subject, 0);
                    createQuestionNumbers(state.currentTestResult.subject);
                    
                    // Tampilkan atau sembunyikan panel asisten berdasarkan mode
                    const assistantPanel = document.getElementById(`${state.currentTestResult.subject}-assistant`);
                    if (state.mode === 'learning') {
                        assistantPanel.classList.add('show');
                    } else {
                        assistantPanel.classList.remove('show');
                    }
                    
                    // Mulai timer jika mode simulasi
                    if (state.mode === 'simulation') {
                        startTimer(state.currentTestResult.subject);
                        state.testStarted[state.currentTestResult.subject] = true;
                    }
                    
                    changeScreen(state.currentTestResult.subject);
                }
            });
            
            document.getElementById('back-to-welcome').addEventListener('click', () => changeScreen('welcome'));
            document.getElementById('save-result').addEventListener('click', saveTestResultToSystem);
        });
    </script>
</body>
    </html>
